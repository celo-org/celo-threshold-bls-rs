version: 2.1

jobs:
  build-wasm:
    docker:
      - image: cimg/base:stable
    steps:
      - checkout
      - setup_remote_docker
      - run:
          name: Build WASM
          command: make wasm
      - store_artifacts:
          path: output/wasm

  build-jvm:
    docker:
      - image: cimg/base:stable
    steps:
      - checkout
      - setup_remote_docker
      - run:
          name: Build JVM
          command: make jvm
      - store_artifacts:
          path: output/jvm

  build-android:
    docker:
      - image: cimg/base:stable
    steps:
      - checkout
      - setup_remote_docker
      - run:
          name: Build Android
          command: make android
      - store_artifacts:
          path: /output/android

  build-ios:
    macos:
      xcode: 15.1.0
    steps:
      - checkout
      - run:
          name: Install Rust
          command: |
            curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y --default-toolchain 1.82.0
            source "$HOME/.cargo/env"
      - run:
          name: Build iOS
          command: make ios
      - store_artifacts:
          path: output/ios

workflows:
  version: 2
  build:
    jobs:
      - build-wasm
      - build-jvm
      - build-android
      - build-ios
